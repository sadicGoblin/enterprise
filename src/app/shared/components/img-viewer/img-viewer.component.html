<div class="img-viewer-container" *ngIf="images && images.length > 0" style="display: none">
  <!-- Main Image Display -->
  <div class="main-image-container">
    <div class="image-wrapper">
      <!-- Loading Spinner -->
      <div *ngIf="isLoading" class="loading-overlay">
        <div class="spinner"></div>
      </div>
      
      <!-- Error Message -->
      <div *ngIf="imageError" class="error-overlay">
        <mat-icon>broken_image</mat-icon>
        <p>Error al cargar la imagen</p>
      </div>
      
      <!-- Main Image -->
      <img 
        *ngIf="currentImage && !imageError"
        [src]="currentImage" 
        [alt]="'Imagen ' + (currentIndex + 1) + ' de ' + images.length"
        class="main-image clickable-image"
        (load)="onImageLoad()"
        (error)="onImageError()"
        (loadstart)="onImageLoadStart()"
        (click)="openImageModal(currentImage)"
      />
    </div>
    
    <!-- Navigation Buttons -->
    <div *ngIf="hasMultipleImages" class="navigation-buttons">
      <button 
        mat-fab 
        color="primary" 
        class="nav-button prev-button"
        (click)="previousImage()"
        [attr.aria-label]="'Imagen anterior'"
      >
        <mat-icon>chevron_left</mat-icon>
      </button>
      
      <button 
        mat-fab 
        color="primary" 
        class="nav-button next-button"
        (click)="nextImage()"
        [attr.aria-label]="'Siguiente imagen'"
      >
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
    
    <!-- Image Counter -->
    <div *ngIf="hasMultipleImages" class="image-counter">
      {{ currentIndex + 1 }} / {{ images.length }}
    </div>
  </div>
  
  <!-- Thumbnail Navigation (Optional) -->
  <div *ngIf="showThumbnails && hasMultipleImages" class="thumbnails-container">
    <div class="thumbnails-wrapper">
      <div 
        *ngFor="let image of images; let i = index" 
        class="thumbnail"
        [class.active]="i === currentIndex"
        (click)="goToImage(i)"
      >
        <img 
          [src]="image" 
          [alt]="'Miniatura ' + (i + 1)"
          class="thumbnail-image"
        />
      </div>
    </div>
  </div>
  
  <!-- Dots Indicator (when thumbnails are hidden) -->
  <div *ngIf="!showThumbnails && hasMultipleImages" class="dots-container">
    <button 
      *ngFor="let image of images; let i = index"
      class="dot"
      [class.active]="i === currentIndex"
      (click)="goToImage(i)"
      [attr.aria-label]="'Ir a imagen ' + (i + 1)"
    ></button>
  </div>
</div>

<!-- No Images Message -->
<div *ngIf="!images || images.length === 0" class="no-images">
  <mat-icon>image</mat-icon>
  <p>No hay im√°genes para mostrar</p>
</div>


<div class="image-pdf" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px">
  <div 
    *ngFor="let image of images; let i = index"
    style="border: 1px solid #ccc; border-radius: 4px; height: 250px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
    <img
      [src]="image || ''"
      [alt]="'Imagen ' + (i + 1)"
      style="max-width: 100%; max-height: 100%; object-fit: contain; cursor: pointer;"
      (error)="imageError = true"
      (click)="openImageModal(image)"
    />
  </div>
</div>

<!-- Image Modal -->
<div *ngIf="isModalOpen" class="image-modal-overlay" (click)="closeImageModal()">
  <div class="image-modal-container" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="modal-header">
      <div class="modal-controls">
        <button mat-icon-button (click)="zoomOut()" [disabled]="modalZoom <= 0.5">
          <mat-icon>zoom_out</mat-icon>
        </button>
        <button mat-icon-button (click)="zoomIn()" [disabled]="modalZoom >= 3">
          <mat-icon>zoom_in</mat-icon>
        </button>
        <button mat-icon-button (click)="resetZoom()">
          <mat-icon>fit_screen</mat-icon>
        </button>
        <button mat-icon-button (click)="rotateImage()">
          <mat-icon>rotate_right</mat-icon>
        </button>
      </div>
      <button mat-icon-button (click)="closeImageModal()" class="close-button">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    
    <!-- Modal Image -->
    <div class="modal-image-container">
      <img 
        [src]="modalImageSrc" 
        alt="Imagen ampliada"
        class="modal-image"
        [style.transform]="modalImageTransform"
      />
    </div>
  </div>
</div>

