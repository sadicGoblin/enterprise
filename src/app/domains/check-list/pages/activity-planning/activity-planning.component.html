<div class="container">
  <mat-card class="mat-container">
    <h2 class="title">Planificaci√≥n Actividades</h2>

    <div class="filters-container">
      <app-custom-select
        label="Proyecto"
        [formControl]="projectControl"
        [parameterType]="projectParameterType"
        [loadFromApi]="true"
        [customApiEndpoint]="projectApiEndpoint"
        [customApiRequestBody]="projectApiRequestBody"
        [customOptionValueKey]="projectOptionValue"
        [customOptionLabelKey]="projectOptionLabel"
        (selectionChange)="onProjectSelectionChange($event)"
        placeholder="Seleccionar Proyecto"
        [required]="true"
        appearance="fill"
      ></app-custom-select>

      <app-custom-select
        #collaboratorSelect
        label="Colaborador"
        [formControl]="collaboratorControl"
        [parameterType]="collaboratorParameterType"
        [loadFromApi]="true"
        [customApiEndpoint]="collaboratorApiEndpoint"
        [customApiRequestBody]="collaboratorApiRequestBody"
        [customOptionValueKey]="collaboratorOptionValue"
        [customOptionLabelKey]="collaboratorOptionLabel"
        (selectionChange)="onCollaboratorSelectionChange($event)"
        placeholder="Seleccionar Colaborador"
        appearance="fill"
      ></app-custom-select>

      <mat-form-field appearance="fill">
        <mat-label>Periodo (Actual)</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          [(ngModel)]="selectedPeriod"
          [value]="selectedPeriod"
          (dateChange)="onPeriodChange($event)"
          [placeholder]="formattedPeriod || 'MM/YYYY'"
          readonly
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker
          #picker
          startView="multi-year"
          [startAt]="selectedPeriod"
          (monthSelected)="setMonthAndYear($event, picker)"
          panelClass="month-picker"
        ></mat-datepicker>
      </mat-form-field>

      <div class="button-container">
        <button
          mat-raised-button
          color="primary"
          class="consultar-btn"
          (click)="onConsultarClick()"
        >
          <mat-icon>search</mat-icon>
          Consultar
        </button>
      </div>
    </div>

    <div class="section-separator" *ngIf="showPlanificationTable"></div>

    <!-- Loading indicator -->
    <div class="loading-container" *ngIf="isLoading">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Cargando actividades...</p>
    </div>

    <div class="no-activities" *ngIf="noActivities">
      <p>No se encontraron actividades para este proyecto y/o colaborador.</p>
    </div>

    <div *ngIf="showPlanificationTable">
      <div class="cronograma-header">
        <h3>DETALLE CRONOGRAMA MENSUAL</h3>
        <div class="header-actions">
          <button
            mat-icon-button
            (click)="viewCronogramaPdf()"
            class="view-button"
            aria-label="Visualizar cronograma PDF"
            [disabled]="viewingPdf"
            title="Visualizar PDF"
          >
            <mat-icon>visibility</mat-icon>
          </button>
          <button
            mat-icon-button
            (click)="exportCronogramaToPdf()"
            class="export-button"
            aria-label="Exportar cronograma a PDF"
            [disabled]="exportingPdf"
            title="Descargar PDF"
          >
            <mat-icon>picture_as_pdf</mat-icon>
          </button>
        </div>
      </div>

      <div class="cronograma-content" id="cronograma-content">
        <!-- Comentado temporalmente - usando planification-grid en su lugar
        <app-planification-table
          [activities]="activities"
          [days]="days"
          [selectedPeriod]="selectedPeriod"
          [projectId]="selectedProjectId"
          [selectedCollaboratorName]="selectedCollaboratorName"
          [selectedCollaboratorId]="selectedCollaboratorId"
          (activityStatusChanged)="handleActivityStatusChanged($event)"
          (saveChanges)="saveAllChanges()"
        ></app-planification-table>
        -->

        <app-planification-grid
          [periodo]="numericPeriod"
          [idUsuario]="selectedCollaboratorId ? +selectedCollaboratorId : null"
          [projectId]="selectedProjectId"
          [selectedCollaboratorName]="selectedCollaboratorName"
          [selectedCollaboratorId]="selectedCollaboratorId"
          (activityClicked)="handleGridActivityClicked($event)"
        ></app-planification-grid>
      </div>
    </div>
  </mat-card>
</div>
