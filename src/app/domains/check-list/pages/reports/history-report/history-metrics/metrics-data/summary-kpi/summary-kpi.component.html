<div class="chart-card kpi-dashboard-card mt-4">
  <ng-container *ngIf="hasData; else noData">
    <!-- Encabezado con totales -->
    <div class="chart-header">
      <div class="chart-title">
        <mat-icon>{{ getGeneralIcon('settings') }}</mat-icon>
        <h3>{{ title }}</h3>
      </div>
      <div class="total-badge">
        <span class="total-value">{{ getTotalRegistros() | number }}</span>
        <span class="total-label">REGISTROS</span>
      </div>
    </div>

    <!-- Contenido dinámico basado en summaryValues del reportConfig -->
    <div class="chart-content kpi-card-content">
      <ng-container *ngIf="reportConfig && reportConfig.summaryValues && reportConfig.summaryValues.length > 0">
        <div class="metrics-row">

          <!-- Datos del campo configurado -->
          <ng-container *ngFor="let fieldName of reportConfig.summaryValues; let fieldIndex = index">
            <div class="column-equal">
              <div class="metrics-section"
                *ngIf="summaryData[fieldName] && getObjectKeys(summaryData[fieldName]).length > 0">
                <div class="section-header">
                  <mat-icon>{{ getFieldIconForDisplay(fieldName) }}</mat-icon>
                  <span>{{ getFieldDisplayName(fieldName) | uppercase }}</span>
                  <span class="count-indicator">({{ getObjectKeys(summaryData[fieldName]).length }})</span>
                </div>
                <div class="metrics-list custom-scrollbar vertical-list">
                  <div class="metric-item" *ngFor="let value of getObjectKeys(summaryData[fieldName]); let i = index">
                    <div class="metric-dot" [style.background-color]="getChartColor(i, value)"></div>
                    <div class="metric-name" [title]="value">{{ value }}</div>
                    <div class="metric-value">{{ summaryData[fieldName][value] }}</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Gráfico para el campo configurado -->
            <div class="column-equal">
              <div class="chart-container"
                *ngIf="summaryData[fieldName] && getObjectKeys(summaryData[fieldName]).length > 0">
                <div class="section-header">
                  <mat-icon>{{ getGeneralIcon('chart') || 'pie_chart' }}</mat-icon>
                  <span>GRÁFICO {{ getFieldDisplayName(fieldName) | uppercase }}</span>
                </div>
                <div class="pie-chart-container">
                  <div class="pie-chart-placeholder">
                    <canvas [attr.id]="'chart-' + fieldName"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </ng-container>

      <!-- Mensaje cuando no hay campos configurados -->
      <div class="no-config-message" *ngIf="hasMissingSummaryConfig()">
        <mat-icon>settings</mat-icon>
        <span>No hay campos configurados para mostrar en el resumen</span>
      </div>
    </div>
  </ng-container>

  <ng-template #noData>
    <div class="no-data-message">
      <mat-icon>info_outline</mat-icon>
      <span>Sin datos para mostrar</span>
    </div>
  </ng-template>
</div>