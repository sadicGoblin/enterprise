<!-- Componente genérico de exportación -->
<app-export-selector
  style="display: none;"
  [exportableItems]="exportableItems"
  [externalSelectedIds]="getSelectedElements()"
  [externalSelectedOrder]="selectedElementsOrder"
  [showToolbar]="true"
  [showSelectedPanel]="true"
  toolbarTitle="Exportación de Reportes"
  selectedPanelTitle="Elementos seleccionados para exportación:"
  (exportModeChange)="onExportModeChange($event)"
  (selectionChange)="onSelectionChange($event)"
  (exportRequested)="onExportRequested($event)"
  (orderChange)="onOrderChange($event)">
</app-export-selector>

<!-- Primer componente: summary-kpi con diseño idéntico al tradicional -->
<!-- IMPORTANTE: Usamos completeData (datos sin filtrar) para este componente -->
<!-- Esto garantiza que siempre muestre la distribución total de los datos -->
<div class="component-wrapper" [class.export-mode]="exportMode">
  <div class="selection-overlay" 
       *ngIf="exportMode" 
       [class.selected]="isElementSelected('summary-kpi')"
       (click)="toggleElementSelection('summary-kpi')">
    <mat-icon class="selection-icon">{{isElementSelected('summary-kpi') ? 'check_circle' : 'radio_button_unchecked'}}</mat-icon>
  </div>
  <app-summary-kpi 
    [completeData]="data" 
    [reportConfig]="reportConfig"
    [title]="'DATOS GLOBALES'">
  </app-summary-kpi>
</div>


<!-- Sección dinámica de gráficos basados en filtros activos (componente completamente separado) -->
<div class="dynamic-charts-container">
  <div class="dynamic-charts-section">
    <div class="section-header dynamic-charts-header">
      <br><br>
    </div>

    <div class="dynamic-charts-grid">
      <div class="component-wrapper" 
           [class.export-mode]="exportMode"
           *ngFor="let chart of dynamicCharts; let i = index">
        <div class="selection-overlay" 
             *ngIf="exportMode" 
             [class.selected]="isElementSelected('dynamic-chart-' + i)"
             (click)="toggleElementSelection('dynamic-chart-' + i)">
          <mat-icon class="selection-icon">{{isElementSelected('dynamic-chart-' + i) ? 'check_circle' : 'radio_button_unchecked'}}</mat-icon>
        </div>
        <app-dynamic-chart 
          [filterType]="chart.filterType"
          [hierarchicalFilters]="_hierarchicalFilters"
          [fieldToFilter]="chart.fieldName" 
          [completeData]="data"
          [reportConfig]="reportConfig" 
          [title]="'KPI ' + (chart.filterType || '.')">
        </app-dynamic-chart>
      </div>
    </div>
  </div>

  <ng-template #noData>
    <div class="no-data-message">
      <mat-icon>info_outline</mat-icon>
      <span>Sin datos para mostrar</span>
    </div>
  </ng-template>
</div>