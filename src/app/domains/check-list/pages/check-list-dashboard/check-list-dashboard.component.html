<div class="dashboard-container">
  <!-- Cabecera y filtros -->
  <div class="dashboard-header" @fadeIn>
    <div class="header-title">
      <h1>Panel de Control de Actividades</h1>
      <div class="filter-toggle">
        <button mat-button (click)="toggleFilters()" color="primary" class="filter-button">
          <mat-icon>filter_list</mat-icon>
          {{ showFilters ? 'Ocultar filtros' : 'Mostrar filtros' }}
        </button>
      </div>
    </div>
    
    <!-- Panel de filtros -->
    <div class="filters-panel" [@filterAnimation]="showFilters ? 'show' : 'hide'">
      <div class="filters-content">
        <mat-form-field appearance="outline">
          <mat-label>Proyecto</mat-label>
          <mat-select [(ngModel)]="selectedProject" (selectionChange)="onFilterChange()">
            <mat-option value="">Todos los proyectos</mat-option>
            <mat-option *ngFor="let project of projects" [value]="project">{{ project }}</mat-option>
          </mat-select>
        </mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>Usuario</mat-label>
          <mat-select [(ngModel)]="selectedUser" (selectionChange)="onFilterChange()">
            <mat-option value="">Todos los usuarios</mat-option>
            <mat-option *ngFor="let user of users" [value]="user">{{ user }}</mat-option>
          </mat-select>
        </mat-form-field>
        
        <mat-form-field appearance="outline">
          <mat-label>Ámbito</mat-label>
          <mat-select [(ngModel)]="selectedScope" (selectionChange)="onFilterChange()">
            <mat-option value="">Todos los ámbitos</mat-option>
            <mat-option *ngFor="let scope of scopes" [value]="scope">{{ scope }}</mat-option>
          </mat-select>
        </mat-form-field>
        
        <button mat-flat-button color="accent" (click)="clearFilters()">
          <mat-icon>clear</mat-icon> Limpiar filtros
        </button>
      </div>
    </div>
  </div>
  
  <!-- Tarjetas de métricas principales -->
  <app-metrics-cards 
    [complianceRate]="complianceRate"
    [totalUsers]="totalUsers"
    [pendingActivities]="pendingActivities"
    [totalActivities]="totalActivities"
    [totalProjects]="totalProjects"
    [pendingPercentage]="pendingPercentage"
    @fadeIn>
  </app-metrics-cards>
  
  <!-- Gráficos -->
  <div class="charts-container">
    <!-- Primera fila de gráficos -->
    <div class="charts-row">
      <!-- Gráfico de dona (Total Actividades: Asignadas vs Completadas) -->
      <app-donut-chart 
        [rawData]="rawData"
        [selectedProject]="selectedProject"
        [selectedUser]="selectedUser"
        [selectedScope]="selectedScope"
        @fadeIn>
      </app-donut-chart>
      
      <!-- Gráfico de barras (cumplimiento por proyecto) -->
      <app-bar-chart 
        [rawData]="rawData"
        [selectedProject]="selectedProject"
        [selectedUser]="selectedUser"
        [selectedScope]="selectedScope"
        @fadeIn>
      </app-bar-chart>
    </div>
    
    <!-- Gráfico de línea (cumplimiento diario) - ocupa todo el ancho -->
    <div class="charts-row full-width-chart">
      <app-line-chart 
        [rawData]="rawData"
        [selectedProject]="selectedProject"
        [selectedUser]="selectedUser"
        [selectedScope]="selectedScope"
        @fadeIn>
      </app-line-chart>
    </div>
    
    <!-- Segunda fila de gráficos -->
    <div class="charts-row">
      <!-- Heatmap (distribución por periodicidad y ámbito) -->
      <app-heatmap 
        [rawData]="rawData"
        [selectedProject]="selectedProject"
        [selectedUser]="selectedUser"
        [selectedScope]="selectedScope"
        @fadeIn>
      </app-heatmap>
      
      <!-- Componente de proyectos activos -->
      <app-active-projects-card
        [totalProjects]="totalProjects"
        [showTrend]="true"
        [trendPercentage]="5"
        @fadeIn>
      </app-active-projects-card>
    </div>
  </div>
  
  <!-- Tabla de actividades recientes -->
  <app-recent-activities 
    [activities]="filteredActivities"
    @fadeIn>
  </app-recent-activities>
</div>