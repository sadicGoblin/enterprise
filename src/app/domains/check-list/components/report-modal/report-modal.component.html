<div class="report-modal-container">
  <div class="report-modal-header">
    <h2>REPORTE DE INCIDENTE</h2>
    <div class="header-actions">
      <button mat-icon-button (click)="exportToPdf()" class="export-button" aria-label="Exportar a PDF">
        <mat-icon>picture_as_pdf</mat-icon>
      </button>
      <button mat-icon-button (click)="closeDialog()" class="close-button" aria-label="Cerrar modal">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Cargando datos del reporte...</p>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="error" class="error-container">
    <mat-icon color="warn">error_outline</mat-icon>
    <p>{{ error }}</p>
  </div>

  <!-- Contenido principal (sólo se muestra si no hay error y no está cargando) -->
  <div *ngIf="!loading && !error" class="report-modal-content">
    <div class="info-container">
      <div class="info-header">
        <span class="fecha">Fecha reporte: {{ reportData.reportDate }}</span>
      </div>

    <!-- Grid condicional para datos de control (solo si idControl existe) -->
    <div class="info-grid control-info-grid" *ngIf="reportData.idControl">
      <!-- Primera fila: Nº Control y Etapa Constructiva -->
      <div class="info-row">
        <div class="info-label">Nº Control</div>
        <div class="info-value">{{ reportData.idControl }}</div>
        <div class="info-label">Etapa Const.</div>
        <div class="info-value">{{ reportData.etapaConst }}</div>
      </div>

      <!-- Segunda fila: Ámbito y Actividad -->
      <div class="info-row">
        <div class="info-label">Ámbito</div>
        <div class="info-value">{{ reportData.ambito }}</div>
        <div class="info-label">Actividad</div>
        <div class="info-value">{{ reportData.actividad }}</div>
      </div>
    </div>

    <div class="info-grid">
      <!-- Tipo de incidente y gravedad potencial -->
      <div class="info-row">
        <div class="info-label">Tipo de incidente</div>
        <div class="info-value">{{ reportData.incidentType }}</div>
        <div class="info-label">Potencial gravedad</div>
        <div class="info-value">{{ reportData.potentialSeverity }}</div>
      </div>

      <!-- Profesional responsable y reportado por -->
      <div class="info-row">
        <div class="info-label">Profesional resp.</div>
        <div class="info-value">{{ reportData.professionalResponsible }}</div>
        <div class="info-label">Reportado por</div>
        <div class="info-value">{{ reportData.reportedBy }}</div>
      </div>

      <!-- Acción a realizar y requiere -->
      <div class="info-row">
        <div class="info-label">Acción a realizar</div>
        <div class="info-value">{{ reportData.action }}</div>
        <div class="info-label">Amerita</div>
        <div class="info-value">{{ reportData.requires }}</div>
      </div>

      <!-- Descripción -->
      <div class="info-row" *ngIf="reportData.description">
        <div class="info-label">Descripción del incidente</div>
        <div class="info-value">{{ reportData.description }}</div>
      </div>

      <!-- Identificación de Causas (Preliminares) -->
      <div class="info-row" *ngIf="reportData.identCausas">
        <div class="info-label">Identificación de Causas (Preliminares)</div>
        <div class="info-value">{{ reportData.identCausas }}</div>
      </div>

      <!-- Empresa Involucrada -->  
      <div class="info-row" *ngIf="reportData.empresa">
        <div class="info-label">Empresa Involucrada</div>
        <div class="info-value">{{ reportData.empresa }}</div>
      </div>

      <!-- Sector Obra Involucrada -->
      <div class="info-row" *ngIf="reportData.sector">
        <div class="info-label">Sector Obra Involucrada</div>
        <div class="info-value">{{ reportData.sector }}</div>
      </div>

      <!-- Riesgo Asociado -->
      <div class="info-row" *ngIf="reportData.riesgo">
        <div class="info-label">Riesgo Asociado</div>
        <div class="info-value">{{ reportData.riesgo }}</div>
      </div>

      <!-- Personas Involucradas -->
      <div class="info-row" *ngIf="reportData.personasInvolucradas">
        <div class="info-label">Personas Involucradas</div>
        <div class="info-value">{{ reportData.personasInvolucradas }}</div>
      </div>

      <!-- Interesados afectados -->
      <div class="info-row" *ngIf="reportData.affectedInterested">
        <div class="info-label">Interesados / Afectados</div>
        <div class="info-value">{{ reportData.affectedInterested }}</div>
      </div>

      <!-- Comunicado a -->
      <div class="info-row" *ngIf="reportData.communicatedTo && reportData.communicatedTo.length > 0">
        <div class="info-label">Comunicado a</div>
        <div class="info-value people-list">
          {{ reportData.communicatedTo.join(", ") }}
        </div>
      </div>
    </div>

    <!-- Sección de evidencia fotográfica -->
    <div class="photo-evidence-section" *ngIf="reportData.photos && reportData.photos.length > 0">
      <h3>Evidencia fotográfica</h3>

      <!-- Componente visualizador de imágenes -->
      <app-img-viewer
        [images]="reportData.photos"
        [showThumbnails]="false"
      ></app-img-viewer>
    </div>
  </div>
</div>
